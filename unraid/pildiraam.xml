<?xml version="1.0" encoding="utf-8"?>
<Container version="2">
  <Name>Pildiraam</Name>
  <Repository>docker.io/YOUR_USERNAME/pildiraam</Repository>
  <Registry>https://hub.docker.com</Registry>
  <Network>bridge</Network>
  <Privileged>false</Privileged>
  <Support>https://github.com/YOUR_USERNAME/pildiraam</Support>
  <Project>https://github.com/YOUR_USERNAME/pildiraam</Project>
  <Overview>
    Pildiraam is a digital photo frame slideshow service for iCloud shared albums.

    Features:
    - Cache-first architecture for instant display
    - Server-side image caching (CORS solution)
    - Fullscreen slideshow with touch controls
    - Weather and clock overlays (optional)
    - Progressive image loading
    - Designed for older devices (iOS 9+)
  </Overview>
  <Category>MediaServer</Category>
  <WebUI>http://[IP]:[PORT:3000]</WebUI>
  <TemplateURL>https://raw.githubusercontent.com/YOUR_USERNAME/pildiraam/main/unraid/pildiraam.xml</TemplateURL>
  <Icon>https://raw.githubusercontent.com/YOUR_USERNAME/pildiraam/main/public/favicon.ico</Icon>
  <ExtraParams></ExtraParams>
  <PostArgs></PostArgs>
  <DonateText></DonateText>
  <DonateLink></DonateLink>
  <Description>
    Pildiraam is a containerized service that displays iCloud shared albums as a digital photo frame slideshow.

    It features a cache-first architecture where images are downloaded from iCloud once and cached locally on disk,
    enabling instant display on subsequent visits. Perfect for older tablets and devices with iOS 9.

    Configuration:
    - Set IMAGE_CACHE_DIR to persist your cached images across container restarts
    - Customize slideshow duration with URL parameters
    - Optional weather and clock overlays
  </Description>

  <!-- Port Configuration -->
  <Ports>
    <Port Name="HTTP" Protocol="tcp" Port="3000" HostPort="3000" Mode="tcp">HTTP access to Pildiraam</Port>
  </Ports>

  <!-- Environment Variables -->
  <Environment>
    <Variable Name="NODE_ENV" Value="production" Description="Node environment (production/development)"/>
    <Variable Name="PORT" Value="3000" Description="Port for HTTP server"/>
    <Variable Name="CACHE_CLEANUP_INTERVAL_MINUTES" Value="1440" Description="Delete unused albums after this many minutes (default: 24 hours)"/>
    <Variable Name="RATE_LIMIT_WINDOW_MS" Value="300000" Description="Rate limit window in milliseconds (default: 5 minutes)"/>
    <Variable Name="RATE_LIMIT_MAX" Value="100" Description="Maximum requests per rate limit window"/>
  </Environment>

  <!-- Volume Mounts -->
  <Volumes>
    <Volume Name="Image Cache" Target="/cache/images" Default="/mnt/user/appdata/pildiraam/cache/images" Mode="rw" Description="Persistent storage for downloaded iCloud images. This directory is critical - all cached photos are stored here." Type="Path" Display="always" Required="true" Mask="false"/>
  </Volumes>

  <!-- Devices (if needed) -->
  <Devices></Devices>

  <!-- Networking -->
  <NetworkMode>bridge</NetworkMode>

  <!-- Health Check -->
  <HealthCheck>
    <Test>CMD node -e "require('http').get('http://localhost:3000/api/health', (r) => {if (r.statusCode !== 200) throw new Error(r.statusCode)})"</Test>
    <Interval>30</Interval>
    <Timeout>10</Timeout>
    <StartPeriod>5</StartPeriod>
    <Retries>3</Retries>
  </HealthCheck>

  <!-- Restart Policy -->
  <RestartPolicy>unless-stopped</RestartPolicy>

  <!-- Logging Configuration -->
  <LogDriver>json-file</LogDriver>
  <LogOpt Name="max-size" Value="10m"/>
  <LogOpt Name="max-file" Value="3"/>

</Container>
